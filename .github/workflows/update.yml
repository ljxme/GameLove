name: Update GameLove Hosts

on:
  schedule:
    # æ¯å°æ—¶è‡ªåŠ¨æ›´æ–°ä¸€æ¬¡
    - cron: '0 * * * *'
  workflow_dispatch:
    inputs:
      force_update:
        description: 'å¼ºåˆ¶æ›´æ–°'
        required: false
        default: 'false'
        type: boolean

jobs:
  update-hosts:
    runs-on: ubuntu-latest
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: è®¾ç½® Python çŽ¯å¢ƒ
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: å®‰è£…ä¾èµ–
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: ç”Ÿæˆ hosts æ–‡ä»¶
      run: |
        cd scripts
        python update_hosts.py
    
    - name: æ£€æŸ¥æ˜¯å¦æœ‰æ›´æ–°
      id: check_changes
      run: |
        if [ -n "$(git status --porcelain)" ]; then
          echo "has_changes=true" >> $GITHUB_OUTPUT
          echo "å‘çŽ°æ–‡ä»¶å˜æ›´"
        else
          echo "has_changes=false" >> $GITHUB_OUTPUT
          echo "æ²¡æœ‰æ–‡ä»¶å˜æ›´"
        fi
    
    - name: æäº¤æ›´æ–°
      if: steps.check_changes.outputs.has_changes == 'true' || github.event.inputs.force_update == 'true'
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add .
        git commit -m "ðŸŽ® è‡ªåŠ¨æ›´æ–° GameLove hosts æ–‡ä»¶ - $(date '+%Y-%m-%d %H:%M:%S')"
        git push
    
    - name: åˆ›å»ºå‘å¸ƒç‰ˆæœ¬
      if: steps.check_changes.outputs.has_changes == 'true' || github.event.inputs.force_update == 'true'
      uses: actions/create-release@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        tag_name: v${{ github.run_number }}
        release_name: GameLove Hosts v${{ github.run_number }}
        body: |
          ðŸŽ® GameLove æ¸¸æˆå¹³å°ç½‘ç»œä¼˜åŒ– - è‡ªåŠ¨æ›´æ–°
          
          ðŸ“… æ›´æ–°æ—¶é—´: ${{ steps.date.outputs.date }}
          ðŸ”„ æ›´æ–°æ–¹å¼: è‡ªåŠ¨æ›´æ–°
          
          ## ðŸ“¥ å¿«é€Ÿä½¿ç”¨
          
          ### æ–¹æ³•ä¸€ï¼šç›´æŽ¥ä¸‹è½½
          ```bash
          # Windows (ç®¡ç†å‘˜æƒé™)
          curl -o C:\Windows\System32\drivers\etc\hosts https://raw.githubusercontent.com/${{ github.repository }}/main/hosts
          
          # Linux/Mac
          sudo curl -o /etc/hosts https://raw.githubusercontent.com/${{ github.repository }}/main/hosts
          ```
          
          ### æ–¹æ³•äºŒï¼šSwitchHosts
          - URL: `https://raw.githubusercontent.com/${{ github.repository }}/main/hosts`
          - è‡ªåŠ¨åˆ·æ–°: 1å°æ—¶
          
          ## ðŸŽ¯ æ”¯æŒå¹³å°
          - Steam
          - Epic Games
          - Origin (EA)
          - Uplay (Ubisoft)
          - Battle.net (Blizzard)
          - GOG
          - Rockstar Games
          
          è®©ä½ "çˆ±"ä¸Šæ¸¸æˆï¼Œè§£å†³è®¿é—®æ…¢ã€è¿žæŽ¥è¶…æ—¶çš„é—®é¢˜ï¼
        draft: false
        prerelease: false
    
    - name: èŽ·å–å½“å‰æ—¶é—´
      id: date
      run: echo "date=$(date '+%Y-%m-%d %H:%M:%S')" >> $GITHUB_OUTPUT
